#!/usr/bin/env python

# this tools filters out lines from stdin that have words that are not in a given corpus
# lines where all words are in the reference vocab are printed to stdout

import optparse
import gzip
import sys
try:
    import psyco
    psyco.full()
except ImportError:
    pass
from sets import Set

def isZipFile(fname):
    fp = open(fname, "rb")
    magic = fp.read(2)
    fp.close()
    return magic == '\x1f\x8b'

def openFile(fileArg, allowNone=True):
    if not fileArg:
        if allowNone:
            return (None, None, False)
        else:
            raise IOError
    if isinstance(fileArg, str):
        if isZipFile(fileArg):
            return (gzip.GzipFile(fileArg), fileArg, True)
        else:
            return (open(fileArg), fileArg, False)
    elif isinstance(fileArg, file):
        return (fileArg, None, False)

def asciiArtFinish(counter):
    sys.stderr.write(" [%d]\n" % counter)

def asciiArt(counter):
    if counter % 10000 == 0 and counter != 0:
        sys.stderr.write(".")
        if counter % 500000 == 0:
            asciiArtFinish(counter)
        sys.stderr.flush()

def main():
    optionParser = optparse.OptionParser()
    optionParser.add_option("--vocab",
                            "-v",
                            metavar="file",
                            dest="vocabFilename",
                            help="lines from input to include in the output")
    (options, args) = optionParser.parse_args()

    vocab = Set()

    for line in openFile(options.vocabFilename)[0] :
        vocab |= Set(line.split())


    for line in sys.stdin :
        lineSet=Set(line.split())
        if lineSet <= vocab :
            sys.stdout.write(line)


if __name__ == "__main__":
    main()

